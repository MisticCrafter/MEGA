namespace = flavor_andalos

# The Purchase of Macau (for province owner)
country_event = {
	id = flavor_andalos.1
	title = flavor_andalos.1.title
	desc = flavor_andalos.1.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

    major = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		668 = {
			set_variable = {
				which = jabber_provCost
				value = 0
			}
			export_to_variable = {
				which = jabber_provCost
				value = monthly_income
				who = ROOT
			}
			multiply_variable = {
				which = jabber_provCost
				value = 24
			}
		}
	}

	option = {
		name = flavor_andalos.1.a
		ai_chance = { 
            factor = 1 
        }
		trigger = {
			668 = {
				is_capital = no
			}
		}

		tooltip = {
            add_years_of_income = 2
			668 = {
				cede_province = FROM
				add_core = FROM
                add_province_modifier = {
                    name = "adu_feitoria"
                    duration = -1
                }
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = flavor_andalos.10 }
			}
		}
	}
	option = {
		name = flavor_andalos.1.b
		ai_chance = { factor = 0 }
		add_prestige = 5
	}
}

# The Purchase of Hizen (for province owner)
country_event = {
	id = flavor_andalos.2
	title = flavor_andalos.2.title
	desc = flavor_andalos.2.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

    major = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		4182 = {
			set_variable = {
				which = jabber_provCost
				value = 0
			}
			export_to_variable = {
				which = jabber_provCost
				value = monthly_income
				who = ROOT
			}
			multiply_variable = {
				which = jabber_provCost
				value = 24
			}
		}
	}

	option = {
		name = flavor_andalos.2.a
		ai_chance = { 
            factor = 1 
        }
		trigger = {
			4182 = {
				is_capital = no
			}
		}

		tooltip = {
            add_years_of_income = 2
			4182 = {
				cede_province = FROM
				add_core = FROM
                center_of_trade = 1
                add_province_modifier = {
                    name = "adu_feitoria"
                    duration = -1
                }
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = flavor_andalos.11 }
			}
		}
	}
	option = {
		name = flavor_andalos.2.b
		ai_chance = { factor = 0 }
		add_prestige = 5
	}
}

# The Purchase of Socotra (for province owner)
country_event = {
	id = flavor_andalos.3
	title = flavor_andalos.3.title
	desc = flavor_andalos.3.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

    major = yes
	fire_only_once = yes
	is_triggered_only = yes

	immediate = {
		1099 = {
			set_variable = {
				which = jabber_provCost
				value = 0
			}
			export_to_variable = {
				which = jabber_provCost
				value = monthly_income
				who = ROOT
			}
			multiply_variable = {
				which = jabber_provCost
				value = 24
			}
		}
	}

	option = {
		name = flavor_andalos.3.a
		ai_chance = { 
            factor = 1 
        }
		trigger = {
			1099 = {
				is_capital = no
			}
		}

		tooltip = {
            add_years_of_income = 2
			1099 = {
				cede_province = FROM
				add_core = FROM
                center_of_trade = 1
                add_province_modifier = {
                    name = "adu_feitoria"
                    duration = -1
                }
			}
		}
		hidden_effect = {
			FROM = {
				country_event = { id = flavor_andalos.12 }
			}
		}
	}
	option = {
		name = flavor_andalos.3.b
		ai_chance = { factor = 0 }
		add_prestige = 5
	}
}

# Andal East India Company
country_event = {
	id = flavor_andalos.4
	title = flavor_andalos.4.title
	desc = flavor_andalos.4.desc
	picture = MERCHANTS_TALKING_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		OR = {
			AND = {
				NOT = { has_dlc = "Golden Century" }
				tag = POR
				has_country_modifier = india_trade_co
			}
			has_country_flag = adu_casa_da_india_flag
		}
	}

	mean_time_to_happen = {
		months = 12
	}

	option = {		
        # Sounds like a good plan.
		name = flavor_andalos.4.a
		add_mercantilism = 10
		add_country_modifier = {
			name = adu_east_india_company_modifier
			duration = -1
		}
	}
}

# Vasco da Gama in India
country_event = {
	id = flavor_andalos.5
	title = flavor_andalos.5.title
	desc = flavor_andalos.5.desc
	picture = SHIP_SAILING_eventPicture

    major = yes
	is_triggered_only = yes

	option = {
        # Glorious! (Goa is controlled by AI)
		name = flavor_andalos.5.a
		trigger = {
			2030 = {
				owner = {
					ai = yes
				}
			}
		}
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0
				overextension_percentage = 1.5
			}
		}
		2030 = { 
            cede_province = ADU
            add_province_modifier = {
                name = "adu_feitoria"
                duration = -1
            }
        }
		add_permanent_claim = 2030
		add_prestige = 10
	}
	option = {
        # Curses, they are too strong! (A player controls Goa)
		name = flavor_andalos.5.b
		trigger = {
			2030 = {
				owner = {
					ai = no
				}
			}
		}
		ai_chance = { factor = 10 }
		add_permanent_claim = 2030
		add_prestige = 10
	}
}

# Vasco da Gama in Burma
country_event = {
	id = flavor_andalos.6
	title = flavor_andalos.6.title
	desc = flavor_andalos.6.desc
	picture = SHIP_SAILING_eventPicture

    major = yes
	is_triggered_only = yes

	option = {
        # Glorious! (Chittagong is controlled by AI)
		name = flavor_andalos.6.a
		trigger = {
			568 = {
				owner = {
					ai = yes
				}
			}
		}
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0
				overextension_percentage = 1.5
			}
		}
		568 = { 
            cede_province = ADU
            add_province_modifier = {
                name = "adu_feitoria"
                duration = -1
            }
        }
		add_permanent_claim = 568
		add_prestige = 10
	}
	option = {
        # Curses, they are too strong! (A player controls Chittagong)
		name = flavor_andalos.6.b
		trigger = {
			568 = {
				owner = {
					ai = no
				}
			}
		}
		ai_chance = { factor = 10 }
		add_permanent_claim = 568
		add_prestige = 10
	}
}

# Christopher Columbus
country_event = {
	id = flavor_andalos.7
	title = flavor_andalos.7.title
	desc = flavor_andalos.7.desc
	picture = SHIP_SAILING_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = ADU
		exploration_ideas = 2
		NOT = { has_global_flag = columbus_happened }
		is_year = 1460
		OR = {
			NOT = {
				north_america = {
					has_discovered = ROOT
				}
			}
			NOT = {
				south_america = {
					has_discovered = ROOT
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}
	
	option = {
        # Reject his proposal
		name = flavor_andalos.7.a
		ai_chance = { factor = 75 }
		set_country_flag = turned_down_columbus
		if = {
			limit = {
				any_known_country = {
					has_idea = quest_for_the_new_world
					religion = catholic
				}
			}
			random_known_country = {
				limit = {
					NOT = { has_country_flag = turned_down_columbus }
					religion = catholic
					has_idea = quest_for_the_new_world
				}
				country_event = { id = flavor_spa.1 }
			}
		}
	}
	option = {
        # Hire Columbus
		name = flavor_andalos.7.b
		ai_chance = { factor = 25 }
		set_global_flag = columbus_happened
		add_years_of_income = -0.10
		define_explorer = {
			name = "Crist�v�o Colombo"
			fire = 2
			shock = 2
			manuever = 6
			siege = 0
		}
	}
}

# Vasco da Gama
country_event = {
	id = flavor_andalos.8
	title = flavor_andalos.8.title
	desc = flavor_andalos.8.desc
	picture = SHIP_SAILING_eventPicture
	
	fire_only_once = yes
	is_triggered_only = yes
	
	trigger = {
		tag = ADU
		exploration_ideas = 2
		1460 = {
            has_discovered = ROOT
        }
        1177 = {
            has_discovered = ROOT
        }
	}

	mean_time_to_happen = {
		months = 10
	}

	option = {
        # Hire Vasco da Gama
		name = flavor_andalos.8.a
		add_years_of_income = -0.25
		define_explorer = {
			name = "Vasco da Gama"
			fire = 4
			shock = 3
			manuever = 4
			siege = 2
		}
	}
}

# Men of Andalos (for african nation)
country_event = {
    id = flavor_andalos.9
    title = flavor_andalos.9.title
	desc = flavor_andalos.9.desc
	picture = PRESTOR_JOHN_eventPicture

    major = yes
    fire_only_once = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_country_flag = andal_african_alliance }
    }

    option = {
        # Ally with Andalos
        name = flavor_andalos.9.a
        ai_chance = { factor = 75 }
        create_alliance = FROM
		add_historical_friend = FROM
        add_country_modifier = {
            name = "adu_african_alliance"
            duration = 7300
        }
		1466 = {
			add_trade_modifier = {
				who = from
				duration = -1
				power = 100
				key = andal_guinea_trade
			}
		}
        every_owned_province = {
            if = {
                limit = {
                    province_has_center_of_trade_of_level = 1
                    has_port = yes
                }
                add_base_production = 2
                add_base_manpower = 2
                add_province_modifier = {
                    name = "adu_feitoria"
                    duration = -1
                }
            }
        }
        FROM = { 
			add_historical_friend = ROOT
			set_country_flag = adu_has_guinean_friend_flag
		}
		set_country_flag = adu_guinean_friend
    }

    option = {
        # Reject them
        name = flavor_andalos.9.b
        ai_chance = { factor = 25 }
        add_prestige_or_monarch_power = {
			amount = 10
		}
    }
}

# The Purchase of Macau (positive reply, for Andalos)
country_event = {
	id = flavor_andalos.10
	title = flavor_andalos.10.title
	desc = flavor_andalos.10.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = flavor_andalos.10.a
        while = {
            limit = {
                668 = {
                    check_variable = {
                        which = jabber_provCost
                        value = 0
                    }
                }
            }
            add_treasury = -2
            subtract_variable = {
                which = jabber_provCost
                value = 2
            }
        }
		668 = {
			cede_province = ROOT
			add_core = ROOT
            add_province_modifier = {
                name = "adu_feitoria"
                duration = -1
            }
		}
	}
}

# The Purchase of Hizen (positive reply, for Andalos)
country_event = {
	id = flavor_andalos.11
	title = flavor_andalos.11.title
	desc = flavor_andalos.11.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = flavor_andalos.11.a
        while = {
            limit = {
				4182 = {
					check_variable = {
						which = jabber_provCost
						value = 0
					}
				}
            }
            add_treasury = -2
			4182 = {
				subtract_variable = {
					which = jabber_provCost
					value = 2
				}
			}
        }
		4182 = {
			cede_province = ROOT
			add_core = ROOT
            center_of_trade = 1
            add_province_modifier = {
                name = "adu_feitoria"
                duration = -1
            }
		}
	}
}

# The Purchase of Socotra (positive reply, for Andalos)
country_event = {
	id = flavor_andalos.12
	title = flavor_andalos.12.title
	desc = flavor_andalos.12.desc
	picture = PORTUGUESE_MERCHANTS_eventPicture

	fire_only_once = yes
	is_triggered_only = yes

	option = {
		name = flavor_andalos.12.a
        while = {
            limit = {
				1099 = {
					check_variable = {
						which = jabber_provCost
						value = 0
					}
				}
            }

            add_treasury = -2
            1099 = {
				subtract_variable = {
					which = jabber_provCost
					value = 2
				}
			}
        }
		1099 = {
			cede_province = ROOT
			add_core = ROOT
            center_of_trade = 1
            add_province_modifier = {
                name = "adu_feitoria"
                duration = -1
            }
		}
	}
}

# Brothers in Faith (spawns for african friend)
country_event = {
	id = flavor_andalos.13
	title = flavor_andalos.13.title
	desc = flavor_andalos.13.desc
	picture = RELIGIOUS_CONVERSION_eventPicture

	major = yes
	fire_only_once = yes

	trigger = {
		ADU = {
			has_country_flag = adu_has_guinean_friend_flag
		}
		has_country_flag = adu_guinean_friend
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = flavor_andalos.13.a
		ai_chance = { factor = 75 }
		change_religion = tigranic
		every_owned_province = {
			limit = {
				development = 10
			}
			change_religion = tigranic
		}
		add_country_modifier = {
			name = "tigranic_more_missionaries"
			duration = 7300
		}
		add_country_modifier = {
			name = "religious_zeal"
			duration = 7300
		}
		capital_scope = {
			add_building_construction = {
				building = cathedral
				speed = 0.5
				cost = 0.5
			}
		}
	}

	option = {
		name = flavor_andalos.13.b
		ai_chance = { factor = 25 }
		add_prestige = 10
		add_country_modifier = {
			name = "adu_rejected_faith_union"
			duration = 7300
		}
		reverse_add_opinion = {
			who = ADU
			modifier = renounced_as_heretics
		}
	}
}

# The Fall of Hellas
country_event = {
	id = flavor_andalos.14
	title = flavor_andalos.14.title
	desc = flavor_andalos.14.desc
	picture = EUROPEAN_REFUGEES_eventPicture

	major = yes
	fire_only_once = yes

	trigger = {
		tag = ADU
		GRE = {
			OR = {
				NOT = { primary_culture = greek }
				exists = no
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = flavor_andalos.14.a
		custom_tooltip = hellenic_refugees_andal_tt
		hidden_effect = {
			ADU = {
				add_prestige = 10
				add_adm_power = -50
				add_country_modifier = {
					name = "adu_hellenic_refugees"
					duration = 7300
				}
			}
			every_known_country = {
				limit = {
					primary_culture = andal
				}
				add_prestige = 10
				add_adm_power = -50
				add_country_modifier = {
					name = "adu_hellenic_refugees"
					duration = 7300
				}
			}
		}
		custom_tooltip = hellenic_refugees_tigranic_tt
		hidden_effect = {
			every_known_country = {
				limit = {
					NOT = { primary_culture = andal }
					religion = tigranic
				}
				add_prestige = 5
				add_adm_power = -10
				add_country_modifier = {
					name = "tigranic_hellenic_refugees"
					duration = 7300
				}
			}
		}
	}
}

# Jabber's Note: yes I know this is probably a very inefficient way to do this, however I don't have that much time left and I really need to hurry this 
#(cede provinces to exarchates)
country_event = {
	id = flavor_andalos.15
	title = flavor_andalos.15.title
	desc = flavor_andalos.15.desc
	picture = EUROPEAN_REFUGEES_eventPicture

	hidden = yes

	trigger = {
		tag = ADU
		any_owned_province = {
			OR = {
				# belongs to Mauretania AND the right Exarchate exists
				AND = {
					exists = AE2
					OR = {
						area = western_morocco_area
                        area = marrekesh_area
                        area = southern_morocco_area
                        area = sus_area
                        area = tafilalt_area
                        area = algiers_area
                        area = hautes_plaines_area
                        area = barbary_coast_area
					}
				}
				# belongs to Africa AND the right Exarchate exists
				AND = {
					exists = AE3
					OR = {
						area = tunisia_area
						area = djerba_area
						area = tripolitania_area
						area = fezzan_area
						area = kabylia_area
						area = ouled_nail_area
						area = north_saharan_area
					}
				}
				# belongs to Italia AND the right Exarchate exists
				AND = {
					exists = AE4
					region = italy_region
				}
				# belongs to Gallia AND the right Exarchate exists
				AND = {
					exists = AE5
					region = france_region
				}
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		name = flavor_andalos.15.a

		# cede to Mauretania
		every_owned_province = {
			limit = {
				exists = AE2
				OR = {
					area = western_morocco_area
					area = marrekesh_area
					area = southern_morocco_area
					area = sus_area
					area = tafilalt_area
					area = algiers_area
					area = hautes_plaines_area
					area = barbary_coast_area
				}
			}
			remove_core = ROOT
			cede_province = AE2
		}

		# cede to Africa
		every_owned_province = {
			limit = {
				exists = AE3
				OR = {
					area = tunisia_area
					area = djerba_area
					area = tripolitania_area
					area = fezzan_area
					area = kabylia_area
					area = ouled_nail_area
					area = north_saharan_area
				}
			}
			remove_core = ROOT
			cede_province = AE3
		}

		# cede to Italia
		every_owned_province = {
			limit = {
				exists = AE4
				region = italy_region
			}
			remove_core = ROOT
			cede_province = AE4
		}

		# cede to Gallia
		every_owned_province = {
			limit = {
				exists = AE5
				region = france_region
			}
			remove_core = ROOT
			cede_province = AE5
			add_prestige = 5
		}
	}
}

# One More Crown (Aragon)
country_event = {
	id = flavor_andalos.16
	title = flavor_andalos.16.title
	desc = flavor_andalos.16.desc
	picture = FEAST_eventPicture

	major = yes
	fire_only_once = yes

	trigger = {
		tag = ADU
		all_known_province = {
			limit = {
				area = aragon_area
			}
			owned_by = ADU
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		id = flavor_andalos.16.a
		every_owned_province = {
			limit = {
				area = aragon_area
			}
			remove_core = ADU
			add_core = ARA
			cede_province = ARA
		}

		create_subject = {
			who = ARA
			type = appanage
		}

		ARA = {
			add_government_reform = andal_subject_reform
			define_ruler = {
				dynasty = ROOT
				culture = ROOT
				religion = ROOT
			}
		}
	}
}

# One More Crown (Catalonia)
country_event = {
	id = flavor_andalos.17
	title = flavor_andalos.17.title
	desc = flavor_andalos.17.desc
	picture = FEAST_eventPicture

	major = yes
	fire_only_once = yes

	trigger = {
		tag = ADU
		all_known_province = {
			limit = {
				area = catalonia_area
			}
			owned_by = ADU
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		id = flavor_andalos.16.a
		every_owned_province = {
			limit = {
				area = catalonia_area
			}
			remove_core = ADU
			add_core = CAT
			cede_province = CAT
		}

		create_subject = {
			who = CAT
			type = appanage
		}

		CAT = {
			add_government_reform = andal_subject_reform
			define_ruler = {
				dynasty = ROOT
				culture = ROOT
				religion = ROOT
			}
		}
	}
}

# One More Crown (Mallorca)
country_event = {
	id = flavor_andalos.18
	title = flavor_andalos.18.title
	desc = flavor_andalos.18.desc
	picture = FEAST_eventPicture

	major = yes
	fire_only_once = yes

	trigger = {
		tag = ADU
		all_known_province = {
			limit = {
				area = baleares_area
			}
			owned_by = ADU
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = {
		id = flavor_andalos.18.a
		every_owned_province = {
			limit = {
				area = baleares_area
			}
			remove_core = ADU
			add_core = MJO
			cede_province = MJO
		}

		create_subject = {
			who = MJO
			type = appanage
		}

		MJO = {
			add_government_reform = andal_subject_reform
			define_ruler = {
				dynasty = ROOT
				culture = ROOT
				religion = ROOT
			}
		}
	}
}